#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Fri Sep  7 15:08:13 2018

@author: omkar
"""

import numpy as np
from sklearn.cluster import KMeans
from sklearn.cluster import DBSCAN
import time
from sklearn.mixture import GaussianMixture
from sklearn.decomposition import PCA
import matplotlib.pyplot as plt
import math

def threshold_filter(data, angles, threshold):
    #filter the angles first
    angles = np.array(angles)
    data = np.array(data)
    half_pi = 0.5 * math.pi
    angle_index = np.where((angles<half_pi)&(-half_pi<angles))
    ang_fil_angles = angles[angle_index]
    ang_fil_ranges = data[angle_index]

    #filter the distance
    dist_index = np.where((0.1 < ang_fil_ranges) &  ( ang_fil_ranges< threshold))
    dist_fil_ranges = ang_fil_ranges[dist_index]
    dist_fil_angles = ang_fil_angles[dist_index]

    return dist_fil_ranges, dist_fil_angles

#ONE FRAME OF RESULT
ranges = [3.6582884788513184, 3.7396106719970703, 3.7712321281433105, 3.818552255630493, 3.885111093521118, 3.956218719482422, 4.017431259155273, 4.102952480316162, 4.155635833740234, 4.228012561798096, 4.300711154937744, 4.382401466369629, 4.448051929473877, 4.535812854766846, 4.606029033660889, 4.71834659576416, 4.795755386352539, 4.913707733154297, 5.017602920532227, 5.109529972076416, 5.225459098815918, 5.351624965667725, 5.452360153198242, 5.5881242752075195, 5.697434902191162, 5.827081680297852, 5.992712020874023, 6.131065368652344, 6.306288242340088, 6.469939708709717, 6.54928731918335, 6.61983585357666, 6.671141147613525, 6.733158588409424, 6.812592506408691, 6.896204948425293, 6.958384990692139, 7.0107645988464355, 7.111623287200928, 7.206821441650391, 7.275625228881836, 7.379377841949463, 7.440603733062744, 7.5278849601745605, 7.601227283477783, 7.686923027038574, 7.783066749572754, 7.853481769561768, 7.911307334899902, 7.968475818634033, 8.03852653503418, 8.10891056060791, 8.16934871673584, 8.198782920837402, 8.260950088500977, 8.303520202636719, 8.3545503616333, 8.385490417480469, 8.435795783996582, 8.467638969421387, 8.515331268310547, 8.555273056030273, 8.586400032043457, 8.624894142150879, 8.675627708435059, 8.695463180541992, 8.712024688720703, 8.74622917175293, 8.787493705749512, 8.816864013671875, 8.83435344696045, 8.856407165527344, 8.871545791625977, 8.903258323669434, 8.914027214050293, 8.942490577697754, 8.928765296936035, 8.961323738098145, 8.95632266998291, 8.99485969543457, 9.000689506530762, 9.00184154510498, 9.022272109985352, 9.018688201904297, 9.030186653137207, 9.03713321685791, 9.054703712463379, 9.071089744567871, 9.076951026916504, 9.05318546295166, 9.064580917358398, 9.069256782531738, 9.077380180358887, 9.096351623535156, 9.103375434875488, 9.09268569946289, 9.129789352416992, 9.128706932067871, 9.134636878967285, 9.11425495147705, 9.145051956176758, 9.14857292175293, 9.148958206176758, 9.158682823181152, 9.160368919372559, 9.196263313293457, 9.194113731384277, 9.19250202178955, 9.202292442321777, 9.200522422790527, 9.210214614868164, 9.196945190429688, 9.19532585144043, 9.195854187011719, 9.2225980758667, 9.195134162902832, 9.211647033691406, 9.20059585571289, 9.186985969543457, 9.203454971313477, 9.199376106262207, 9.174506187438965, 9.18371295928955, 9.1715087890625, 9.163274765014648, 9.168371200561523, 9.168158531188965, 9.153122901916504, 9.138304710388184, 9.134108543395996, 9.116938591003418, 9.085716247558594, 9.102952003479004, 9.067875862121582, 9.055989265441895, 9.044833183288574, 9.034844398498535, 9.027210235595703, 8.984110832214355, 8.973921775817871, 8.992414474487305, 8.934630393981934, 8.93413257598877, 8.906813621520996, 4.377055644989014, 4.245312690734863, 4.150397300720215, 4.061596870422363, 4.009937286376953, 3.9160866737365723, 3.853843927383423, 3.7997305393218994, 3.729710102081299, 3.6775858402252197, 3.609618663787842, 3.5699026584625244, 3.502547025680542, 3.4653267860412598, 3.4132070541381836, 3.3582024574279785, 3.2884931564331055, 3.239252805709839, 3.1766111850738525, 3.1161327362060547, 3.054995059967041, 2.9920222759246826, 2.926694869995117, 2.867394208908081, 2.82997989654541, 2.7858598232269287, 2.755234479904175, 2.689906120300293, 2.658921003341675, 2.6331264972686768, 2.5666468143463135, 2.55637526512146, 2.5037403106689453, 2.4613163471221924, 2.433115243911743, 2.401992082595825, 2.364122152328491, 2.2916412353515625, 2.28067684173584, 2.22619366645813, 2.1974358558654785, 2.1662826538085938, 2.113319158554077, 2.08036470413208, 2.0420358180999756, 2.0216152667999268, 1.9805253744125366, 1.946346640586853, 1.890852689743042, 1.8530733585357666, 1.8199611902236938, 1.8000092506408691, 1.731315016746521, 1.7104790210723877, 1.6629648208618164, 1.617895245552063, 1.5730358362197876, 1.538038730621338, 1.4749037027359009, 1.4436211585998535, 1.4096312522888184, 1.3596440553665161, 1.316182255744934, 1.269484281539917, 1.2443549633026123, 1.1956264972686768, 1.1799540519714355, 1.142640233039856, 1.0911345481872559, 1.0496547222137451, 1.0253868103027344, 1.009676218032837, 0.9768971800804138, 0.9506520628929138, 0.9171485304832458, 0.9176391959190369, 0.8946390151977539, 0.8540064692497253, 0.8492740988731384, 0.8108161091804504, 0.7896053194999695, 0.7738120555877686, 0.7667999267578125, 0.7365257740020752, 0.7117555141448975, 0.7108259201049805, 0.6998659372329712, 0.678531289100647, 0.665238082408905, 0.6498054265975952, 0.640147864818573, 0.628786027431488, 0.6098995208740234, 0.6022517681121826, 0.5932474136352539, 0.5902215838432312, 0.5676051378250122, 0.5743919014930725, 0.5503621101379395, 0.5376935601234436, 0.5298557281494141, 0.5240965485572815, 0.5126746296882629, 0.5238537192344666, 0.49980220198631287, 0.49398913979530334, 0.4748999774456024, 0.48110705614089966, 0.46826106309890747, 0.47506991028785706, 0.45949265360832214, 0.4411017894744873, 0.4497948884963989, 0.44465598464012146, 0.4338805079460144, 0.4364444613456726, 0.422641783952713, 0.42011213302612305, 0.41146141290664673, 0.382607102394104, 0.3870104253292084, 0.383392870426178, 0.399577796459198, 0.38348060846328735, 0.38124045729637146, 0.3907516300678253, 0.3724798262119293, 0.3718510568141937, 0.36890164017677307, 0.36325740814208984, 0.3495623767375946, 0.35156285762786865, 0.3667161166667938, 0.360409677028656, 0.3396405577659607, 0.32667556405067444, 0.32637667655944824, 0.33613690733909607, 0.343463659286499, 0.3446177840232849, 0.3152128756046295, 0.32224369049072266, 0.31934696435928345, 0.3117046654224396, 0.31162387132644653, 0.30819135904312134, 0.31135016679763794, 0.31387290358543396, 0.29282715916633606, 0.29921284317970276, 0.290112167596817, 0.3023568391799927, 0.30042651295661926, 0.29960888624191284, 0.2876604497432709, 0.3052251636981964, 0.29705721139907837, 0.3032475411891937, 0.28200778365135193, 0.26980361342430115, 0.25756311416625977, 0.27596786618232727, 0.27655982971191406, 0.2900680899620056, 0.27572983503341675, 0.26163309812545776, 0.26531532406806946, 0.2428257018327713, 0.28157731890678406, 0.2621839642524719, 0.2684321701526642, 0.2750917971134186, 0.2555204927921295, 0.2518157660961151, 0.264482706785202, 0.265252947807312, 0.24877625703811646, 0.2568896412849426, 0.23573827743530273, 0.2639694809913635, 0.23581013083457947, 0.22833500802516937, 0.25746601819992065, 0.23758839070796967, 0.2455929070711136, 0.24589642882347107, 0.25123801827430725, 0.2330923080444336, 0.23662437498569489, 0.23419365286827087, 0.2193981558084488, 0.23714561760425568, 0.2212115228176117, 0.21105526387691498, 0.21975067257881165, 0.20223493874073029, 0.22266246378421783, 0.2287776619195938, 0.2109196037054062, 0.22218871116638184, 0.20484550297260284, 0.21074505150318146, 0.2134864330291748, 0.223037987947464, 0.21346744894981384, 0.21082176268100739, 0.20714400708675385, 0.21080374717712402, 0.21635068953037262, 0.2149323672056198, 0.20853665471076965, 0.19513697922229767, 0.1875004768371582, 0.19588813185691833, 0.21037927269935608, 0.20164570212364197, 0.18905805051326752, 0.2039058804512024, 0.1879000961780548, 0.194275364279747, 0.1850150227546692, 0.2050812542438507, 0.19507114589214325, 0.18974554538726807, 0.20672394335269928, 0.19321104884147644, 0.20211726427078247, 0.18222834169864655, 0.19500921666622162, 0.19474852085113525, 0.18905174732208252, 0.18269872665405273, 0.18223577737808228, 0.19796493649482727, 0.16988185048103333, 0.17967653274536133, 0.19179078936576843, 0.18866987526416779, 0.19333921372890472, 0.17844824492931366, 0.189386785030365, 0.16485485434532166, 0.1738172173500061, 0.17081913352012634, 0.19580532610416412, 0.19726672768592834, 0.1847236454486847, 0.1795864999294281, 0.18084560334682465, 0.18618746101856232, 0.18565335869789124, 0.1441061645746231, 0.1819336712360382, 0.1776248961687088, 0.16345012187957764, 0.18366725742816925, 0.16397099196910858, 0.16688893735408783, 0.1714370846748352, 0.17113566398620605, 0.1808617264032364, 0.1534983366727829, 0.17569126188755035, 0.1750520020723343, 0.16600361466407776, 0.15154913067817688, 0.152114138007164, 0.156475231051445, 0.16315746307373047, 0.16101370751857758, 0.17424769699573517, 0.171709805727005, 0.16017816960811615, 0.1665240228176117, 0.16101457178592682, 0.1561448872089386, 0.17776048183441162, 0.15332558751106262, 0.15944142639636993, 0.16352684795856476, 0.16832298040390015, 0.14889389276504517, 0.15503738820552826, 0.1648511290550232, 0.15188093483448029, 0.16035225987434387, 0.1652401089668274, 0.16614983975887299, 0.1493937373161316, 0.16842512786388397, 0.16569989919662476, 0.1447216123342514, 0.15886838734149933, 0.13920661807060242, 0.15886670351028442, 0.14355766773223877, 0.15842168033123016, 0.15608282387256622, 0.14398522675037384, 0.1464664787054062, 0.15367665886878967, 0.15097159147262573, 0.1477181315422058, 0.15564914047718048, 0.14439350366592407, 0.1394764930009842, 0.13782058656215668, 0.14655859768390656, 0.15497727692127228, 0.15047740936279297, 0.16254566609859467, 0.1464841514825821, 0.16097691655158997, 0.14574511349201202, 0.1408846527338028, 0.15061987936496735, 0.1288376748561859, 0.14588572084903717, 0.1581132709980011, 0.14737461507320404, 0.15583911538124084, 0.1429545134305954, 0.168193981051445, 0.14484886825084686, 0.13305571675300598, 0.14045189321041107, 0.15197068452835083, 0.15352466702461243, 0.137197345495224, 0.13564236462116241, 0.142934650182724, 0.1510954052209854, 0.1562400609254837, 0.16427193582057953, 0.15021556615829468, 0.13468283414840698, 0.11757189780473709, 0.15337829291820526, 0.1593729704618454, 0.13961763679981232, 0.14868615567684174, 0.15003006160259247, 0.1372535079717636, 0.1528501808643341, 0.13776175677776337, 0.14618080854415894, 0.14679273962974548, 0.13776496052742004, 0.1416095793247223, 0.15212512016296387, 0.13342444598674774, 0.15361632406711578, 0.14881782233715057, 0.1473701447248459, 0.13783979415893555, 0.14506597816944122, 0.1515657901763916, 0.14523008465766907, 0.15116769075393677, 0.14514486491680145, 0.1424483209848404, 0.16240161657333374, 0.15313532948493958, 0.13963443040847778, 0.1288364827632904, 0.1635308712720871, 0.14227129518985748, 0.1429756134748459, 0.13416557013988495, 0.13577209413051605, 0.12130295485258102, 0.15450043976306915, 0.14788691699504852, 0.1485430896282196, 0.13903513550758362, 0.15542367100715637, 0.1492883563041687, 0.1505473107099533, 0.13115836679935455, 0.13925877213478088, 0.12429841607809067, 0.14570178091526031, 0.14698687195777893, 0.1453118473291397, 0.16515003144741058, 0.14123965799808502, 0.15782597661018372, 0.13824774324893951, 0.13104072213172913, 0.14675481617450714, 0.14582902193069458, 0.1355409473180771, 0.134860560297966, 0.1237427219748497, 0.14373785257339478, 0.1647544801235199, 0.1629205197095871, 0.13482391834259033, 0.13659387826919556, 0.12440425157546997, 0.15097147226333618, 0.15052011609077454, 0.1415800154209137, 0.13525108993053436, 0.13380061089992523, 0.13498952984809875, 0.1632765829563141, 0.15263473987579346, 0.13830673694610596, 0.1486331671476364, 0.15940696001052856, 0.1456059217453003, 0.13908451795578003, 0.14977914094924927, 0.14518404006958008, 0.13192301988601685, 0.13629119098186493, 0.14450667798519135, 0.1464451253414154, 0.142690971493721, 0.1372905671596527, 0.14072388410568237, 0.14922145009040833, 0.14758925139904022, 0.13509447872638702, 0.16129879653453827, 0.1501207947731018, 0.15323230624198914, 0.1403493583202362, 0.12460953742265701, 0.14069639146327972, 0.1384219229221344, 0.1383657455444336, 0.1452353298664093, 0.13094361126422882, 0.15749523043632507, 0.1428445279598236, 0.14685168862342834, 0.13926802575588226, 0.14926983416080475, 0.14752814173698425, 0.1557852178812027, 0.15132586658000946, 0.13803373277187347, 0.1269230842590332, 0.13432280719280243, 0.14475193619728088, 0.13185681402683258, 0.14898237586021423, 0.14199388027191162, 0.14900290966033936, 0.1430518627166748, 0.13442176580429077, 0.15373171865940094, 0.1376674324274063, 0.1490010917186737, 0.13180042803287506, 0.1350867599248886, 0.14916980266571045, 0.15177498757839203, 0.15133784711360931, 0.1387546807527542, 0.13710173964500427, 0.14464907348155975, 0.14080514013767242, 0.13933569192886353, 0.1386445164680481, 0.13254621624946594, 0.16071555018424988, 0.13572479784488678, 0.13448144495487213, 0.15047350525856018, 0.13180243968963623, 0.15976788103580475, 0.13970573246479034, 0.16550621390342712, 0.15248887240886688, 0.15170542895793915, 0.15336085855960846, 0.14432412385940552, 0.14469191431999207, 0.15704280138015747, 0.16923147439956665, 0.14252206683158875, 0.1685929298400879, 0.1651221513748169, 0.15956175327301025, 0.1675824075937271, 0.14186431467533112, 0.15141023695468903, 0.16398578882217407, 0.1546558439731598, 0.1616210788488388, 0.15445594489574432, 0.16031962633132935, 0.14731094241142273, 0.15086375176906586, 0.15264847874641418, 0.1437292844057083, 0.15205934643745422, 0.1664387434720993, 0.15326601266860962, 0.14424672722816467, 0.16306674480438232, 0.15824198722839355, 0.1475280374288559, 0.15350303053855896, 0.1589379906654358, 0.1530783772468567, 0.15378879010677338, 0.16049037873744965, 0.16589884459972382, 0.16416949033737183, 0.16460537910461426, 0.1435377448797226, 0.15223264694213867, 0.1865271031856537, 0.17512665688991547, 0.17618469893932343, 0.15416814386844635, 0.169451504945755, 0.15625834465026855, 0.17679351568222046, 0.17925108969211578, 0.16201083362102509, 0.17585450410842896, 0.16924706101417542, 0.16871175169944763, 0.15740595757961273, 0.18697479367256165, 0.16252680122852325, 0.16066694259643555, 0.17955897748470306, 0.16935253143310547, 0.17760618031024933, 0.16658557951450348, 0.16068926453590393, 0.17940634489059448, 0.18545658886432648, 0.16242647171020508, 0.1874905377626419, 0.16886746883392334, 0.17346608638763428, 0.160506471991539, 0.1492626667022705, 0.15919755399227142, 0.18499885499477386, 0.1487625241279602, 0.2019508183002472, 0.17051157355308533, 0.18338249623775482, 0.18632428348064423, 0.1735730767250061, 0.18174177408218384, 0.1685115247964859, 0.17248646914958954, 0.17954674363136292, 0.1682422012090683, 0.1775871366262436, 0.16634272038936615, 0.17833396792411804, 0.1829020231962204, 0.17164219915866852, 0.15773509442806244, 0.17430898547172546, 0.17609594762325287, 0.20704269409179688, 0.16672460734844208, 0.18886074423789978, 0.1664949655532837, 0.18055376410484314, 0.1711704283952713, 0.1866709589958191, 0.1997167319059372, 0.1664266139268875, 0.1918228566646576, 0.18340280652046204, 0.17674976587295532, 0.17409811913967133, 0.18152131140232086, 0.16678020358085632, 0.18185807764530182, 0.17489086091518402, 0.18550486862659454, 0.177544966340065, 0.16857577860355377, 0.1968216598033905, 0.1672016978263855, 0.17135348916053772, 0.19054390490055084, 0.19132941961288452, 0.1748887002468109, 0.18571440875530243, 0.2053578644990921, 0.17561732232570648, 0.1781216263771057, 0.1835492104291916, 0.17073747515678406, 0.16744497418403625, 0.18687686324119568, 0.18290509283542633, 0.17570427060127258, 0.16853588819503784, 0.18906208872795105, 0.19413305819034576, 0.19235248863697052, 0.20057304203510284, 0.183436781167984, 0.1739453226327896, 0.1851935237646103, 0.17861519753932953, 0.18547645211219788, 0.1884673833847046, 0.1839500218629837, 0.18508848547935486, 0.20281469821929932, 0.18789152801036835, 0.19589465856552124, 0.1956196278333664, 0.20137692987918854, 0.20008043944835663, 0.18715982139110565, 0.1810150146484375, 0.18114818632602692, 0.19841593503952026, 0.18313799798488617, 0.1881183236837387, 0.20664635300636292, 0.18978342413902283, 0.21156346797943115, 0.19551101326942444, 0.1999221295118332, 0.19964143633842468, 0.20818500220775604, 0.1928221881389618, 0.19832056760787964, 0.2126520574092865, 0.19284074008464813, 0.2105252742767334, 0.2105647474527359, 0.2124081254005432, 0.2205515205860138, 0.20052602887153625, 0.2057020366191864, 0.2081872522830963, 0.2087503969669342, 0.2115117609500885, 0.21025627851486206, 0.21050672233104706, 0.20548836886882782, 0.20830649137496948, 0.20608559250831604, 0.1966799944639206, 0.2054482400417328, 0.2035738229751587, 0.2038288414478302, 0.2235119640827179, 0.2054504156112671, 0.22554223239421844, 0.22065500915050507, 0.23870910704135895, 0.222147598862648, 0.22964555025100708, 0.22328250110149384, 0.22231312096118927, 0.22074979543685913, 0.21767324209213257, 0.23440170288085938, 0.22320124506950378, 0.23284435272216797, 0.23116794228553772, 0.2305213063955307, 0.23329362273216248, 0.2394695281982422, 0.23389069736003876, 0.21600189805030823, 0.2244434356689453, 0.23469360172748566, 0.24701043963432312, 0.2470407336950302, 0.23850935697555542, 0.23594510555267334, 0.2283925861120224, 0.24664504826068878, 0.2342037409543991, 0.23053979873657227, 0.2256767749786377, 0.25793901085853577, 0.2560659945011139, 0.25389522314071655, 0.24106374382972717, 0.23796771466732025, 0.24372445046901703, 0.24326375126838684, 0.26333609223365784, 0.24479806423187256, 0.2663014531135559, 0.23583541810512543, 0.25144436955451965, 0.26444289088249207, 0.25458699464797974, 0.26622581481933594, 0.2692548930644989, 0.2643667161464691, 0.25471031665802, 0.2783378064632416, 0.26671838760375977, 0.254968523979187, 0.28437119722366333, 0.25902464985847473, 0.27914246916770935, 0.29208308458328247, 0.29049742221832275, 0.28661611676216125, 0.2827858328819275, 0.269126832485199, 0.28062382340431213, 0.26777225732803345, 0.28711292147636414, 0.2785971462726593, 0.28183749318122864, 0.2970973551273346, 0.2841128706932068, 0.2920602560043335, 0.30267566442489624, 0.3201015293598175, 0.30769839882850647, 0.2904587388038635, 0.31461259722709656, 0.28642070293426514, 0.305590957403183, 0.2910890281200409, 0.3167579174041748, 0.3265444338321686, 0.31433916091918945, 0.3155326843261719, 0.3229316174983978, 0.31712111830711365, 0.3317277431488037, 0.32039445638656616, 0.3477659821510315, 0.3354346454143524, 0.3373587727546692, 0.3361780047416687, 0.3409954011440277, 0.34469959139823914, 0.34671473503112793, 0.3491780459880829, 0.35134124755859375, 0.34487098455429077, 0.34905487298965454, 0.34131109714508057, 0.35230302810668945, 0.3746849596500397, 0.34568631649017334, 0.378775030374527, 0.3825122117996216, 0.3862554728984833, 0.3723873198032379, 0.38183853030204773, 0.3880770802497864, 0.3855352997779846, 0.38217079639434814, 0.3882509171962738, 0.3955359160900116, 0.40840184688568115, 0.42118966579437256, 0.4193357229232788, 0.42311179637908936, 0.4221706986427307, 0.4411870539188385, 0.4211428761482239, 0.43214061856269836, 0.4439297020435333, 0.4576706886291504, 0.46123433113098145, 0.43844226002693176, 0.43551820516586304, 0.468890517950058, 0.4614298343658447, 0.4702436923980713, 0.4803225100040436, 0.48238319158554077, 0.4873368442058563, 0.5050273537635803, 0.5103055834770203, 0.499923437833786, 0.5086414813995361, 0.5254925489425659, 0.507872998714447, 0.5202924013137817, 0.5156770944595337, 0.5344323515892029, 0.5599190592765808, 0.5475513935089111, 0.5732244849205017, 0.5830138921737671, 0.5771622657775879, 0.5854741930961609, 0.5943804979324341, 0.6179594397544861, 0.62418133020401, 0.6386038661003113, 0.6518856883049011, 0.6473665833473206, 0.646824836730957, 0.6583372354507446, 0.6674699783325195, 0.6993647813796997, 0.6920316815376282, 0.7134093046188354, 0.7315343618392944, 0.7336270213127136, 0.7710801362991333, 0.7890247702598572, 0.7849133610725403, 0.7957771420478821, 0.8222688436508179, 0.8228015303611755, 0.8487703800201416, 0.8670117259025574, 0.8869183659553528, 0.9186424016952515, 0.9228022694587708, 0.9686278104782104, 0.9859690070152283, 1.0027766227722168, 1.032707691192627, 1.0479297637939453, 1.0987471342086792, 1.1243470907211304, 1.1592066287994385, 1.188359022140503, 1.2135066986083984, 1.2627090215682983, 1.311234951019287, 1.3399219512939453, 1.3927394151687622, 1.4495429992675781, 1.4810433387756348, 1.564483404159546, 1.6307843923568726, 1.6962008476257324, 1.7585943937301636, 1.8730980157852173, 1.9449304342269897, 2.0371150970458984, 2.14524245262146, 2.3024637699127197, 2.418043613433838, 2.597484827041626, 2.78507661819458, 2.990595817565918, 3.2119221687316895, 3.3910889625549316, 3.4052164554595947, 3.4253673553466797, 3.4369354248046875, 3.4394495487213135, 3.4711573123931885, 3.473210096359253, 3.4999799728393555, 3.506723642349243, 3.5340757369995117, 3.5464396476745605, 3.590891122817993, 3.5972084999084473, 3.5929105281829834, 3.6208057403564453, 3.6288259029388428, 3.649466037750244, 3.6797971725463867, 3.67838978767395, 3.7025339603424072, 3.732619047164917, 3.717759132385254, 3.7631592750549316, 3.7847049236297607, 3.8149943351745605, 3.8349807262420654, 3.863878011703491, 3.8770642280578613, 3.9131951332092285, 3.9188406467437744, 3.9479382038116455, 3.9659342765808105, 3.9674010276794434, 3.991008758544922, 4.011460304260254, 4.0639729499816895, 4.083565711975098, 4.080831527709961, 4.113277435302734, 4.143096446990967, 4.153462886810303, 4.192114353179932, 4.214412212371826, 4.250467300415039, 4.258721828460693, 4.292891502380371, 4.311520576477051, 4.330530166625977, 4.376836776733398, 4.394825458526611, 4.423614025115967, 4.442343235015869, 4.492214679718018, 4.496888160705566, 4.526393890380859, 4.559811115264893, 4.608811378479004, 4.630834579467773, 4.658029079437256, 4.678950309753418, 4.708864212036133, 4.737656593322754, 4.780239582061768, 4.814779758453369, 4.859922409057617, 4.886255264282227, 4.928282737731934, 4.9464263916015625, 4.994396209716797, 5.035085201263428, 5.070518493652344, 5.109525680541992, 5.132854461669922, 5.1984148025512695, 5.215533256530762, 5.267404079437256, 5.297009468078613, 5.362036228179932, 5.410013675689697, 5.439250469207764, 5.46218729019165, 5.516031742095947, 5.58366250991821]
angles = np.zeros(len(ranges))
locations = np.zeros((len(ranges),2))
#GET THE ANGLES
for i in range(len(ranges)):
    increment = 0.00436331471428
    angles[i] = -2.3561899662 + increment * i
    
filteredRanges, filteredAngles = threshold_filter(ranges,angles,4)

start = time.time()


locations = np.zeros((len(filteredRanges),2))
#GET THE Polar POSITIONs
for i in range(len(filteredRanges)):
    
    locations[i,0] = filteredRanges[i] 
    locations[i,1] = filteredAngles[i]
    

#COMPUTE DBSCAN
db = DBSCAN(eps=0.3, min_samples=2).fit(locations)
prediction = db.labels_
print(prediction)


#print('Time spent on this code: %.2f' %(time.time()-start))
#

xs = [x[0] for x in locations]
ys = [y[1] for y in locations]

##PLOT
color_list = ['orange','blue','green','C3','C4','C5','C6','C7','C8','C9']
color = [color_list[i] for i in prediction]
fig = plt.figure()
ax = fig.add_subplot(111, projection='polar')
ax.scatter(ys, xs, c= color)
plt.scatter(0,0,c="C3")

### Index of last point of first obstacle
lastPtOb1 = np.where(np.array(prediction) == 0)[-1][-1]

### Index of first point of second obstacle
firstPtOb2 = np.where(np.array(prediction) == 1)[-1][0]

centerTheta = (filteredAngles[lastPtOb1] + filteredAngles[firstPtOb2])/2
centerR = (filteredRanges[lastPtOb1] + filteredRanges[firstPtOb2])/2

ax.scatter(centerTheta,centerR,c = 'green')
plt.show()

###
#%%

fig = plt.figure()
ax = fig.add_subplot(111, projection='polar')
ax.scatter(angles, ranges, c= color)
plt.scatter(0,0,c="C3")

### Index of last point of first obstacle
lastPtOb1 = np.where(np.array(prediction) == 0)[-1][-1]

### Index of first point of second obstacle
firstPtOb2 = np.where(np.array(prediction) == 1)[-1][0]

centerTheta = (filteredAngles[lastPtOb1] + filteredAngles[firstPtOb2])/2
centerR = (filteredRanges[lastPtOb1] + filteredRanges[firstPtOb2])/2

ax.scatter(centerTheta,centerR,c = 'green')
plt.show()




